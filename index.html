<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Анонимизация данных через ИИ</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#2563eb',secondary:'#64748b'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
body {
font-family: 'Inter', sans-serif;
background-color: #fafafa;
}
.hero-section {
  /* Удалён внешний фон с Readdy */
  background: linear-gradient(90deg, #f8fafc 60%, #e0e7ef 100%);
}
.input-focus:focus {
outline: none;
border-color: #2563eb;
}
.custom-checkbox {
appearance: none;
-webkit-appearance: none;
width: 1.25rem;
height: 1.25rem;
border: 2px solid #d1d5db;
border-radius: 4px;
cursor: pointer;
position: relative;
}
.custom-checkbox:checked {
background-color: #2563eb;
border-color: #2563eb;
}
.custom-checkbox:checked::after {
content: "";
position: absolute;
top: 0.25rem;
left: 0.4rem;
width: 0.3rem;
height: 0.6rem;
border: solid white;
border-width: 0 2px 2px 0;
transform: rotate(45deg);
}
.custom-switch {
position: relative;
display: inline-block;
width: 3rem;
height: 1.5rem;
}
.custom-switch input {
opacity: 0;
width: 0;
height: 0;
}
.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #ccc;
transition: .4s;
border-radius: 34px;
}
.slider:before {
position: absolute;
content: "";
height: 1.1rem;
width: 1.1rem;
left: 0.2rem;
bottom: 0.2rem;
background-color: white;
transition: .4s;
border-radius: 50%;
}
input:checked + .slider {
background-color: #2563eb;
}
input:checked + .slider:before {
transform: translateX(1.5rem);
}
.custom-range {
-webkit-appearance: none;
width: 100%;
height: 6px;
border-radius: 5px;
background: #e5e7eb;
outline: none;
}
.custom-range::-webkit-slider-thumb {
-webkit-appearance: none;
appearance: none;
width: 18px;
height: 18px;
border-radius: 50%;
background: #2563eb;
cursor: pointer;
}
.custom-range::-moz-range-thumb {
width: 18px;
height: 18px;
border-radius: 50%;
background: #2563eb;
cursor: pointer;
border: none;
}
</style>
</head>
<body>
<!-- Header -->
<header class="w-full bg-white shadow-sm sticky top-0 z-50">
<div class="container mx-auto px-4 py-4 flex items-center justify-between">
<div class="flex items-center">
<h1 class="text-2xl text-primary">AI Privacy Assistant</h1>
</div>
<!-- Удаляем кнопки Главная и О проекте -->
<div class="flex items-center">
<button class="md:hidden ml-4 w-10 h-10 flex items-center justify-center">
<i class="ri-menu-line ri-lg"></i>
</button>
</div>
</div>
</header>
<!-- Hero Section -->
<section class="hero-section w-full relative">
<div class="absolute inset-0 bg-gradient-to-r from-white via-white/90 to-transparent"></div>
<div class="container mx-auto px-4 py-24 relative">
<div class="max-w-2xl">
<h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Локальная анонимизация данных через ИИ</h2>
<p class="text-lg text-gray-700 mb-8">Защитите конфиденциальность ваших данных при использовании инструментов искусственного интеллекта. Наш сервис обеспечивает полную анонимизацию информации без передачи на сторонние серверы.</p>
<div class="flex flex-wrap gap-4">
<button id="scroll-to-panel" class="bg-primary text-white px-6 py-3 !rounded-button whitespace-nowrap hover:bg-blue-600 transition-colors shadow-lg">Начать работу</button>
<button id="scroll-to-benefits" class="bg-white text-primary border border-primary px-6 py-3 !rounded-button whitespace-nowrap hover:bg-gray-50 transition-colors">Узнать больше</button>
</div>
</div>
</div>
</section>
<!-- Main Content -->
<section class="py-16 bg-white">
<div class="container mx-auto px-4">
<div class="text-center mb-16">
<h3 class="text-3xl font-bold text-gray-900 mb-4">Защита приватности в приоритете</h3>
<p class="text-lg text-gray-600 max-w-3xl mx-auto">Наш инструмент позволяет безопасно работать с конфиденциальными данными, автоматически анонимизируя их перед отправкой в ИИ-сервисы.</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
<!-- Анонимизация текста -->
<div class="bg-white rounded shadow-lg p-6 hover:shadow-xl transition-shadow">
<div class="w-12 h-12 flex items-center justify-center bg-blue-100 rounded-full mb-4">
<i class="ri-file-text-line ri-lg text-primary"></i>
</div>
<h4 class="text-xl font-semibold mb-3">Анонимизация текста</h4>
<p class="text-gray-600">Автоматическое обнаружение и маскирование персональных данных, конфиденциальной информации и корпоративных секретов в текстовых документах.</p>
</div>
<!-- Анонимизация изображений -->
<div class="bg-white rounded shadow-lg p-6 hover:shadow-xl transition-shadow">
<div class="w-12 h-12 flex items-center justify-center bg-blue-100 rounded-full mb-4">
<i class="ri-image-line ri-lg text-primary"></i>
</div>
<h4 class="text-xl font-semibold mb-3">Анонимизация изображений</h4>
<p class="text-gray-600">Обнаружение и размытие лиц, номерных знаков, документов и другой чувствительной информации на фотографиях и скриншотах.</p>
</div>
<!-- Анонимизация файлов -->
<div class="bg-white rounded shadow-lg p-6 hover:shadow-xl transition-shadow">
<div class="w-12 h-12 flex items-center justify-center bg-blue-100 rounded-full mb-4">
<i class="ri-file-line ri-lg text-primary"></i>
</div>
<h4 class="text-xl font-semibold mb-3">Анонимизация файлов</h4>
<p class="text-gray-600">Комплексная обработка документов различных форматов (PDF, DOCX, XLSX) с удалением метаданных и маскированием конфиденциальной информации.</p>
</div>
</div>
<!-- Панель управления -->
<div id="panel-section" class="bg-gray-50 rounded-lg p-8 mb-16">
<h3 class="text-2xl font-bold text-gray-900 mb-6">Панель управления анонимизацией</h3>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
<!-- Левая колонка - Загрузка -->
<div class="lg:col-span-1 space-y-6">
<div class="bg-white p-6 rounded shadow">
<h4 class="text-lg font-semibold mb-4">Загрузка данных</h4>
<!-- Форма для загрузки файла -->
<form id="file-upload-form" enctype="multipart/form-data">
  <div class="border-2 border-dashed border-gray-300 rounded p-6 text-center mb-4 hover:border-primary transition-colors cursor-pointer">
    <div class="w-12 h-12 flex items-center justify-center mx-auto mb-2">
      <i class="ri-upload-cloud-line ri-2x text-gray-400"></i>
    </div>
    <p class="text-gray-600 mb-2">Перетащите файлы сюда или</p>
    <input type="file" name="file" id="file-input" class="hidden" />
    <button type="button" id="file-select-btn" class="text-primary font-medium hover:underline !rounded-button whitespace-nowrap">выберите файл</button>
  </div>
  <div class="text-sm text-gray-500">
    Поддерживаемые форматы: TXT, DOCX, PDF, JPG
  </div>
  <button type="submit" class="mt-4 bg-primary text-white px-4 py-2 !rounded-button">Анонимизировать файл</button>
</form>
</div>
</div>
<!-- Центральная и правая колонки - Предпросмотр и результаты -->
<div class="lg:col-span-2 space-y-6">
<div class="bg-white p-6 rounded shadow">
<div class="flex justify-between items-center mb-4">
<h4 class="text-lg font-semibold">Предпросмотр</h4>
<div class="flex items-center text-sm text-gray-500">
<div class="w-4 h-4 flex items-center justify-center mr-1">
<i class="ri-shield-check-line text-green-500"></i>
</div>
Локальная обработка активна
</div>
</div>
<!-- Заменяем статический текст на textarea -->
<form id="text-anon-form">
  <textarea id="input-text" class="w-full border rounded p-2 mb-4 min-h-[120px]" rows="6" placeholder="Введите текст для анонимизации"></textarea>
  <div class="flex flex-wrap gap-3 mb-4">
    <div class="flex items-center">
      <input type="checkbox" id="names" class="custom-checkbox mr-2" checked>
      <label for="names" class="text-gray-700 text-sm">Имена</label>
    </div>
    <div class="flex items-center">
      <input type="checkbox" id="contacts" class="custom-checkbox mr-2" checked>
      <label for="contacts" class="text-gray-700 text-sm">Контакты</label>
    </div>
    <div class="flex items-center">
      <input type="checkbox" id="dates" class="custom-checkbox mr-2" checked>
      <label for="dates" class="text-gray-700 text-sm">Даты</label>
    </div>
    <div class="flex items-center">
      <input type="checkbox" id="ids" class="custom-checkbox mr-2" checked>
      <label for="ids" class="text-gray-700 text-sm">Номера документов</label>
    </div>
    <div class="flex items-center">
      <input type="checkbox" id="addresses" class="custom-checkbox mr-2" checked>
      <label for="addresses" class="text-gray-700 text-sm">Адреса</label>
    </div>
  </div>
  <button type="submit" class="bg-primary text-white px-6 py-2 !rounded-button whitespace-nowrap hover:bg-blue-600 transition-colors w-full">Применить анонимизацию</button>
</form>
</div>
<div class="bg-white p-6 rounded shadow">
<h4 class="text-lg font-semibold mb-4">Результат анонимизации</h4>
<div id="anon-result" class="border rounded p-4 mb-4 min-h-[120px] bg-gray-50 text-gray-700"></div>
</div>
</div>
</div>
<!-- Информационный блок -->
<div id="benefits-section" class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
<div>
<h3 class="text-2xl font-bold text-gray-900 mb-6">Преимущества использования</h3>
<div class="space-y-4">
<div class="flex">
<div class="w-10 h-10 flex items-center justify-center bg-blue-100 rounded-full flex-shrink-0 mr-4">
<i class="ri-shield-line ri-lg text-primary"></i>
</div>
<div>
<h4 class="text-lg font-semibold mb-1">Полная конфиденциальность</h4>
<p class="text-gray-600">Все операции выполняются локально на вашем устройстве, без передачи данных на сторонние серверы.</p>
</div>
</div>
<div class="flex">
<div class="w-10 h-10 flex items-center justify-center bg-blue-100 rounded-full flex-shrink-0 mr-4">
<i class="ri-ai-generate ri-lg text-primary"></i>
</div>
<div>
<h4 class="text-lg font-semibold mb-1">Интеграция с ИИ-сервисами</h4>
<p class="text-gray-600">Безопасно используйте возможности ИИ для работы с конфиденциальными данными после их анонимизации.</p>
</div>
</div>
<div class="flex">
<div class="w-10 h-10 flex items-center justify-center bg-blue-100 rounded-full flex-shrink-0 mr-4">
<i class="ri-settings-line ri-lg text-primary"></i>
</div>
<div>
<h4 class="text-lg font-semibold mb-1">Гибкие настройки</h4>
<p class="text-gray-600">Настраивайте уровень анонимизации в зависимости от типа данных и требуемой степени защиты.</p>
</div>
</div>
<div class="flex">
<div class="w-10 h-10 flex items-center justify-center bg-blue-100 rounded-full flex-shrink-0 mr-4">
<i class="ri-time-line ri-lg text-primary"></i>
</div>
<div>
<h4 class="text-lg font-semibold mb-1">Экономия времени</h4>
<p class="text-gray-600">Автоматическая анонимизация вместо ручной обработки экономит до 90% времени сотрудников.</p>
</div>
</div>
</div>
</div>
<div>
<h3 class="text-2xl font-bold text-gray-900 mb-6">Статистика безопасности</h3>
<div class="bg-white p-6 rounded shadow">
<div class="grid grid-cols-2 gap-4 mb-6">
<div class="text-center">
<div class="text-4xl font-bold text-primary mb-1">100%</div>
<p class="text-gray-600">Локальная обработка</p>
</div>
<div class="text-center">
<div class="text-4xl font-bold text-primary mb-1">99.9%</div>
<p class="text-gray-600">Точность обнаружения</p>
</div>
<div class="text-center">
<div class="text-4xl font-bold text-primary mb-1">256-бит</div>
<p class="text-gray-600">Шифрование</p>
</div>
<div class="text-center">
<div class="text-4xl font-bold text-primary mb-1">0</div>
<p class="text-gray-600">Утечек данных</p>
</div>
</div>
<div class="border-t pt-4">
<h4 class="text-lg font-semibold mb-3">Соответствие стандартам</h4>
<div class="flex flex-wrap gap-2">
<span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm">GDPR</span>
<span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm">HIPAA</span>
<span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm">ISO 27001</span>
<span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm">ФЗ-152</span>
<span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm">PCI DSS</span>
</div>
</div>
</div>
</div>
</div>
<!-- Примеры работы системы -->
<div class="mb-16">
<h3 class="text-2xl font-bold text-gray-900 mb-6">Примеры работы системы</h3>
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
<div class="bg-white rounded shadow p-4">
<div class="mb-3">
<div class="text-sm font-medium text-gray-500 mb-1">До анонимизации:</div>
<div class="bg-gray-50 p-3 rounded text-gray-700 min-h-[100px]">
Пациент: Петров Алексей Иванович<br>
Дата рождения: 12.05.1978<br>
Полис ОМС: 1234 5678 9012 3456<br>
Диагноз: Гипертоническая болезнь
</div>
</div>
<div>
<div class="text-sm font-medium text-gray-500 mb-1">После анонимизации:</div>
<div class="bg-gray-50 p-3 rounded text-gray-700 min-h-[100px]">
Пациент: [ФИО]<br>
Дата рождения: [ДАТА]<br>
Полис ОМС: [НОМЕР_ПОЛИСА]<br>
Диагноз: Гипертоническая болезнь
</div>
</div>
</div>
<div class="bg-white rounded shadow p-4">
<div class="mb-3">
<div class="text-sm font-medium text-gray-500 mb-1">До анонимизации:</div>
<div class="bg-gray-50 p-3 rounded text-gray-700 min-h-[100px]">
Уважаемая Светлана Викторовна!<br><br>
Ваша заявка на кредит №A-12345 от 23.04.2023 одобрена. Для уточнения деталей свяжемся с вами по телефону +7 (916) 987-65-43.
</div>
</div>
<div>
<div class="text-sm font-medium text-gray-500 mb-1">После анонимизации:</div>
<div class="bg-gray-50 p-3 rounded text-gray-700 min-h-[100px]">
Уважаемый(ая) [ИМЯ]!<br><br>
Ваша заявка на кредит №[НОМЕР_ЗАЯВКИ] от [ДАТА] одобрена. Для уточнения деталей свяжемся с вами по телефону [ТЕЛЕФОН].
</div>
</div>
</div>
<div class="bg-white rounded shadow p-4">
<div class="mb-3">
<div class="text-sm font-medium text-gray-500 mb-1">До анонимизации:</div>
<div class="bg-gray-50 p-3 rounded text-gray-700 min-h-[100px]">
Договор №2023/157-АБ<br>
ООО "Технопром"<br>
ИНН: 7712345678<br>
Адрес: г. Москва, ул. Ленина, д. 15, офис 301
</div>
</div>
<div>
<div class="text-sm font-medium text-gray-500 mb-1">После анонимизации:</div>
<div class="bg-gray-50 p-3 rounded text-gray-700 min-h-[100px]">
Договор №[НОМЕР_ДОГОВОРА]<br>
[НАЗВАНИЕ_ОРГАНИЗАЦИИ]<br>
ИНН: [ИНН]<br>
Адрес: [АДРЕС]
</div>
</div>
</div>
</div>
</div>
<!-- Chat Bot -->
<div class="fixed bottom-6 right-6 z-50">
<div id="chat-container" class="fixed bottom-0 right-0 md:right-6 z-50 bg-white shadow-xl w-full md:w-96 md:rounded-t-lg overflow-hidden">
<div class="bg-primary text-white p-4 flex justify-between items-center cursor-pointer" id="chat-header">
<div class="flex items-center">
<div class="w-8 h-8 flex items-center justify-center bg-white/20 rounded-full mr-3">
<i class="ri-robot-line"></i>
</div>
<h4 class="font-semibold">AI Privacy Assistant</h4>
</div>
<button id="minimize-chat" class="w-8 h-8 flex items-center justify-center hover:bg-blue-600 rounded-full transition-colors">
<i class="ri-subtract-line ri-lg"></i>
</button>
</div>
<div class="h-[70vh] md:h-[600px] overflow-y-auto p-4 space-y-4" id="chat-messages">
<div class="flex">
<div class="w-8 h-8 flex items-center justify-center bg-primary text-white rounded-full flex-shrink-0 mr-2">
<i class="ri-robot-line"></i>
</div>
<div class="bg-gray-100 rounded-lg p-3 max-w-[80%]">
<p class="text-gray-800">Здравствуйте! Я ваш AI-ассистент по анонимизации данных. Я помогу вам безопасно обработать ваши конфиденциальные данные для использования в ИИ-сервисах. Что бы вы хотели сделать?</p>
<div class="mt-3 flex flex-wrap gap-2">
<button class="bg-white text-primary border border-primary px-3 py-1 rounded-full text-sm hover:bg-blue-50 transition-colors">Анонимизировать текст</button>
<button class="bg-white text-primary border border-primary px-3 py-1 rounded-full text-sm hover:bg-blue-50 transition-colors">Обработать изображение</button>
<button class="bg-white text-primary border border-primary px-3 py-1 rounded-full text-sm hover:bg-blue-50 transition-colors">Узнать больше</button>
</div>
</div>
</div>
</div>
<div class="p-4 border-t bg-white">
<div class="flex items-center gap-2">
<button class="w-10 h-10 flex items-center justify-center text-gray-500 hover:bg-gray-100 rounded-full transition-colors">
<i class="ri-attachment-2"></i>
</button>
<div class="flex-1 relative">
<input type="text" placeholder="Введите сообщение..." class="w-full px-4 py-2 pr-10 border rounded-full input-focus text-sm">
<button class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center text-primary hover:bg-blue-50 rounded-full transition-colors">
<i class="ri-send-plane-line"></i>
</button>
</div>
</div>
</div>
</div>
<button id="open-chat" class="bg-primary text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-blue-600 transition-colors">
<i class="ri-customer-service-line ri-lg"></i>
</button>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Прокрутка по кнопкам "Начать работу" и "Узнать больше"
  document.getElementById('scroll-to-panel').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('panel-section').scrollIntoView({behavior: 'smooth'});
  });
  document.getElementById('scroll-to-benefits').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('benefits-section').scrollIntoView({behavior: 'smooth'});
  });

  // --- ФАЙЛЫ: отображение имени выбранного файла в основной форме ---
  const fileInput = document.getElementById('file-input');
  const fileSelectBtn = document.getElementById('file-select-btn');
  const fileUploadForm = document.getElementById('file-upload-form');
  const anonResult = document.getElementById('anon-result');
  let fileNameSpan = document.createElement('span');
  fileNameSpan.id = 'main-file-name';
  fileNameSpan.className = 'block text-xs text-gray-500 mt-2';
  fileSelectBtn.parentElement.appendChild(fileNameSpan);

  fileSelectBtn.addEventListener('click', function(e) {
    e.preventDefault();
    fileInput.click();
  });
  fileInput.addEventListener('change', function() {
    fileNameSpan.textContent = fileInput.files.length ? 'Файл выбран: ' + fileInput.files[0].name : '';
  });
  fileUploadForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    if (!fileInput.files.length) return alert('Выберите файл!');
    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    anonResult.textContent = 'Обработка...';
    try {
      const res = await fetch('/anon_file', { method: 'POST', body: formData });
      const data = await res.json();
      if (data.result && typeof data.result === 'string' && data.result.startsWith('data:image/')) {
        anonResult.innerHTML = `<img src="${data.result}" alt="Анонимизированное изображение" style="max-width:100%;max-height:400px;display:block;margin:auto;">`;
      } else {
        anonResult.textContent = data.result || data.error || 'Ошибка обработки';
      }
    } catch (e) {
      anonResult.textContent = 'Ошибка соединения с сервером';
    }
  });

  // --- ЧАТ: загрузка файла и отображение имени ---
  const chatFileBtn = document.querySelector('.ri-attachment-2').parentElement;
  let chatFileInput = document.getElementById('chat-file-input');
  let chatFileName = document.getElementById('chat-file-name');
  let chatFile = null;

  if (!chatFileInput) {
    chatFileInput = document.createElement('input');
    chatFileInput.type = 'file';
    chatFileInput.id = 'chat-file-input';
    chatFileInput.style.display = 'none';
    chatFileBtn.parentElement.appendChild(chatFileInput);
  }
  if (!chatFileName) {
    chatFileName = document.createElement('span');
    chatFileName.id = 'chat-file-name';
    chatFileName.className = 'text-xs text-gray-500 ml-2';
    chatFileBtn.parentElement.appendChild(chatFileName);
  }

  chatFileBtn.addEventListener('click', function(e) {
    e.preventDefault();
    chatFileInput.click();
  });
  chatFileInput.addEventListener('change', function() {
    if (chatFileInput.files.length) {
      chatFile = chatFileInput.files[0];
      chatFileName.textContent = 'Файл выбран: ' + chatFile.name;
    } else {
      chatFile = null;
      chatFileName.textContent = '';
    }
  });

  // ЧАТ-БОТ
  const chatInput = document.querySelector('input[type="text"]');
  const chatSendButton = document.querySelector('.ri-send-plane-line').parentElement;
  const chatMessages = document.getElementById('chat-messages');

  chatInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      sendMessage();
    }
  });
  chatSendButton.addEventListener('click', function(e) {
    e.preventDefault();
    sendMessage();
  });

  chatMessages.addEventListener('click', function(e) {
    const btn = e.target.closest('button.bg-white.text-primary');
    if (btn && chatMessages.contains(btn)) {
      e.preventDefault();
      const userMessage = btn.textContent;
      addMessage(userMessage, true);
      setTimeout(() => {
        let botResponse = '';
        switch(userMessage) {
          case 'Анонимизировать текст':
            botResponse = 'Отлично! Вы можете вставить текст прямо сюда, и я помогу вам удалить все персональные данные. Какой тип информации вы хотите анонимизировать?';
            break;
          case 'Обработать изображение':
            botResponse = 'Для обработки изображений я могу помочь скрыть лица, номера документов и другую конфиденциальную информацию. Загрузите изображение, и мы начнем.';
            break;
          case 'Узнать больше':
            botResponse = 'Наш сервис обеспечивает безопасную локальную обработку данных для их использования в ИИ-сервисах. Вся обработка происходит на вашем устройстве. Что именно вас интересует?';
            break;
        }
        addMessage(botResponse, false);
      }, 500);
    }
  });

  async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message && !chatFile) return;
    addMessage(message || (chatFile ? 'Файл отправлен: ' + chatFile.name : ''), true);
    chatInput.value = '';
    // Отправка файла или текста
    if (chatFile) {
      const formData = new FormData();
      formData.append('file', chatFile);
      addMessage('Файл загружается...', false);
      try {
        const res = await fetch('/anon_file', { method: 'POST', body: formData });
        const data = await res.json();
        if (data.result && typeof data.result === 'string' && data.result.startsWith('data:image/')) {
          addMessage('<img src="' + data.result + '" alt="Анонимизированное изображение" style="max-width:100%;max-height:400px;display:block;margin:auto;">', false);
        } else {
          addMessage(data.result || data.error || 'Ошибка обработки', false);
        }
      } catch (e) {
        addMessage('Ошибка соединения с сервером', false);
      }
      chatFile = null;
      chatFileInput.value = '';
      chatFileName.textContent = '';
      return;
    }
    if (message) {
      let isText = message.length > 10 || message.includes(' ');
      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({message, isText})
        });
        const data = await res.json();
        addMessage(data.reply || 'Ошибка ответа от ассистента.', false);
        if (isText && document.getElementById('anon-result')) {
          document.getElementById('anon-result').textContent = data.reply || '';
        }
      } catch (e) {
        addMessage('Ошибка соединения с сервером', false);
      }
    }
  }

  function addMessage(text, isUser) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'flex ' + (isUser ? 'justify-end' : '');
    const iconDiv = document.createElement('div');
    iconDiv.className = `w-8 h-8 flex items-center justify-center rounded-full flex-shrink-0 ${isUser ? 'ml-2 bg-gray-200' : 'mr-2 bg-primary text-white'}`;
    iconDiv.innerHTML = `<i class="ri-${isUser ? 'user' : 'robot'}-line"></i>`;
    const messageContent = document.createElement('div');
    messageContent.className = `${isUser ? 'bg-blue-50' : 'bg-gray-100'} rounded-lg p-3 max-w-[80%]`;
    messageContent.innerHTML = `<p class="text-gray-800">${text}</p>`;
    if (isUser) {
      messageDiv.appendChild(messageContent);
      messageDiv.appendChild(iconDiv);
    } else {
      messageDiv.appendChild(iconDiv);
      messageDiv.appendChild(messageContent);
    }
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  // ТЕКСТ: отправка на анонимизацию с учётом чекбоксов
  document.getElementById('text-anon-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const text = document.getElementById('input-text').value;
    const features = [];
    if (document.getElementById('names').checked) features.push('names');
    if (document.getElementById('contacts').checked) features.push('contacts');
    if (document.getElementById('dates').checked) features.push('dates');
    if (document.getElementById('ids').checked) features.push('ids');
    if (document.getElementById('addresses').checked) features.push('addresses');
    anonResult.textContent = 'Обработка...';
    try {
      const res = await fetch('/anon_text', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({text, features})
      });
      if (!res.ok) {
        anonResult.textContent = 'Ошибка сервера: ' + res.status;
        return;
      }
      const data = await res.json();
      anonResult.textContent = data.result || data.error || 'Ошибка обработки';
    } catch (e) {
      anonResult.textContent = 'Ошибка соединения с сервером';
    }
  });

  // --- ЧАТ-БОТ: сворачивание/разворачивание по клику на header ---
  const chatContainer = document.getElementById('chat-container');
  const chatHeader = document.getElementById('chat-header');
  const chatMessagesBlock = document.getElementById('chat-messages');
  let chatMinimized = false;

  function setChatMinimized(minimized) {
    chatMinimized = minimized;
    if (chatMinimized) {
      chatMessagesBlock.style.display = 'none';
      chatContainer.classList.add('md:rounded-b-lg');
    } else {
      chatMessagesBlock.style.display = 'block';
      chatContainer.classList.remove('md:rounded-b-lg');
    }
  }

  chatHeader.addEventListener('click', function(e) {
    // Не реагировать на клик по кнопке свернуть (иконка)
    if (e.target.closest('#minimize-chat')) return;
    setChatMinimized(!chatMinimized);
  });

  document.getElementById('minimize-chat').addEventListener('click', function(e) {
    e.preventDefault();
    setChatMinimized(!chatMinimized);
  });

});
</script>
</body>
</html>